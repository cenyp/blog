```ts
import { notification } from "ant-design-vue";
import { createVNode } from "vue";
import { useUUId } from "@/utils/index";

let hasUpdate = false;
let oldTag: string = "";
let newTag: string = "";
let key: string = "";

async function init() {
  oldTag = await getScriptText();

  // vite 下监听 vite:preloadError 会更好，动态加载事件错误
  window.addEventListener("unhandledrejection", function (event) {
    // 处理错误
    console.error("未处理的 Promise 错误:", event);
    if (
      event.reason?.message?.includes(
        "Failed to fetch dynamically imported module"
      )
    )
      check(true);
  });

  setInterval(() => {
    console.log("系统监测中...");
    check();
  }, 10 * 60 * 1000);
}

async function check(isFore?: boolean) {
  console.log("检查系统是否更新...");
  if (!isFore) {
    if (hasUpdate) return;
    hasUpdate = true;
  } else {
    hasUpdate = false;
  }
  newTag = await getScriptText();
  compare();
}

function compare() {
  if (key) {
    notification.close(key);
    key = "";
  }

  if (oldTag !== newTag) {
    console.log("系统更新");
    systemUpdate();
  } else {
    console.log("系统未更新");
  }
}

async function getScriptText() {
  const html = await fetch("/", {
    method: "HEAD",
    cache: "no-cache",
  });
  return html.headers.get("etag") || html.headers.get("last-modified") || "-1";
}

function systemUpdate() {
  key = useUUId();
  notification.success({
    message: "温馨提示",
    placement: "bottomRight",
    duration: null,
    style: {
      width: "260px",
    },
    key: key,
    description: createVNode("div", {}, [
      "当前系统已更新版本，请点击下方按钮重启系统",
      createVNode("br"),
      createVNode("br"),
      createVNode(
        "button",
        {
          style:
            "color: #04b78c; border: 1px solid #04b78c; text-shadow: none; border-radius: 4px; padding: 4px 15px; cursor: pointer;background: white;",
          onclick() {
            hasUpdate = false;
            location.reload();
          },
        },
        ["更新系统"]
      ),
    ]),
    onClose: () => {
      hasUpdate = false;
    },
  });
}

export default { init, check };
```

原理是利用 http 文件的 etag 和 last-modified 做判断 index.html 文件是否更新，如果更新则弹出通知框，点击通知框的按钮则刷新页面。

同时，处理点击链接带来的错误。利用 window.addEventListener('unhandledrejection',...) 做错误捕捉
